\subsection{网络流总结}

\subsubsection*{最小割集, 最小割必须边以及可行边}

\paragraph{最小割集} 从 $S$ 出发, 在残余网络中BFS所有权值非 $0$ 的边(包括反向边),得到点集$\{S\}$, 另一集为$\{V\} - \{S\}$. 
\paragraph{最小割集必须点} 残余网络中S直接连向的点必在S的割集中, 直接连向T的点必在T的割集中; 若这些点的并集为全集, 则最小割方案唯一.
\paragraph{最小割可行边} 在残余网络中求强联通分量, 将强联通分量缩点后, 剩余的边即为最小割可行边, 同时这些边也必然满流.
\paragraph{最小割必须边} 在残余网络中求强联通分量, 若S出发可到u, T出发可到v, 等价于$\mathrm{scc}_S=\mathrm{scc}_u$且$\mathrm{scc}_T = \mathrm{scc}_v$, 则该边为必须边.

\subsubsection*{常见问题}

\paragraph{最大权闭合子图}
点权, 限制条件形如: 选择A则必须选择B, 选择B则必须选择C, D. 建图方式: B向A连边, CD向B连边.
求解: S向正权点连边, 负权点向T连边, 其余边容量 $\infty$, 求最小割, 答案为S所在最小割集.
\paragraph{二次布尔型(文理分科)}
$n$ 个点分为两类, $i$ 号点有 $l_{i}$ 或 $r_{i}$ 的代价, $i, j$ 同属一侧分别获得 $l_{ij}$ 或 $r_{ij}$ 的代价, 问最小代价.
$L\rightarrow i: (l_i + 1/2 \sum_{j} l_{ij})$, $i \rightarrow R: (r_i + 1/2 \sum_{j} r_{ij})$,
$i \leftrightarrow j: 1/2 (l_{ij} + r_{ij})$. 实现时边权乘 2 为整数, 求解后答案除 2 为整数. 图拆点可以看作二分图.

如果是二元限制是分类不同时有一个代价 $d_{ij}$，建图可以简化为 $L\rightarrow i: l_i$, $i \rightarrow R: r_i$,
$i \leftrightarrow j: d_{ij}$. 经典例子: \texttt{xor} 最小值, 按位拆开建图.

\paragraph{混合图欧拉回路}把无向边随便定向, 计算每个点的入度和出度, 如果有某个点出入度之差$\mathrm{deg}_i=\mathrm{in}_i-\mathrm{out}_i$为奇数, 肯定不存在欧拉回路. 对于$\mathrm{deg}_i>0$的点, 连接边$(i,T,\mathrm{deg}_i/2)$;对于$\mathrm{deg}_i<0$的点, 连接边$(S,i,-\mathrm{deg}_i/2)$. 最后检查是否满流即可. 
\paragraph{二物流}
水源 $S_1$, 水汇 $T_1$, 油源 $S_2$, 油汇 $T_2$, 每根管道流量共用. 求流量和最大.
建超级源 $SS_1$ 汇 $TT_1$, 连边 $SS_1\to S_1$,$SS_1\to S_2$,$T_1\to TT_1$,$T_2 \to TT_1$, 设最大流为 $x_1$.
建超级源 $SS_2$ 汇 $TT_2$, 连边 $SS_2 \to S_1$, $SS_2\to T_2$,$T_1\to TT_2$, $S_2\to TT_2$, 设最大流为 $x_2$.
则最大流中水流量 $\frac{x_1 + x_2}{2}$, 油流量 $\frac{x_1-x_2}{2}$.

\paragraph{无源汇有上下界可行流}
每条边$(u,v)$ 有一个上界容量$C_{u,v}$和下界容量$B_{u,v}$, 我们让下界变为$0$,上界变为$C_{u,v}-B_{u,v}$, 但这样做流量不守恒. 建立超级源点$SS$和超级汇点$TT$, 用$du_i$来记录每个节点的流量情况, $du_i=\sum B_{j,i}-\sum B_{i,j}$, 添加一些附加弧. 当$du_i>0$时, 连边$(SS,i,du_i)$;当$du_i<0$时, 连边$(i,TT,-du_i)$. 最后对$(SS,TT)$求一次最大流即可, 当所有附加边全部满流时(即$\mathrm{maxflow}==所有du_i>0之和$)时有可行解. 
\paragraph{有源汇有上下界最大可行流}
建立超级源点$SS$和超级汇点$TT$, 首先判断是否存在可行流, 用无源汇有上下界可行流的方法判断. 增设一条从$T$到$S$没有下界容量为无穷的边, 那么原图就变成了一个无源汇有上下界可行流问题. 同样地建图后, 对$(SS,TT)$进行一次最大流, 判断是否有可行解. 
如果有可行解, 删除超级源点$SS$和超级汇点$TT$, 并删去$T$ 到$S$的这条边, 再对$(S,T)$进行一次最大流, 此时得到的$\mathrm{maxflow}$即为有源汇有上下界最大可行流. 
\paragraph{有源汇有上下界最小可行流}
建立超级源点$SS$和超级汇点$TT$, 和无源汇有上下界可行流一样新增一些边, 然后从SS到TT跑最大流. 接着加上边$(T,S,\infty)$, 再从$SS$到$TT$跑一遍最大流. 
如果所有新增边都是满的, 则存在可行流, 此时$T$到$S$这条边的流量即为最小可行流. 
\paragraph{有上下界费用流}
如果求无源汇有上下界最小费用可行流或有源汇有上下界最小费用最大可行流, 用1.6.3.1/1.6.3.2 的构图方法, 给边加上费用即可. 
求有源汇有上下界最小费用最小可行流, 要先用1.6.3.3的方法建图, 先求出一个保证必要边满流情况下的最小费用. 如果费用全部非负, 那么这时的费用就是答案. 如果费用有负数, 那么流多了可能更好, 继续做从$S$到$T$的流量任意的最小费用流, 加上原来的费用就是答案. 
\paragraph{费用流消负环}
新建超级源SS汇TT, 对于所有流量非空的负权边e, 先流满(\texttt{ans+=e.f*e.c, e.rev.f+=e.f, e.f=0}), 再连边SS$\to$e.to, e.from$\to$TT, 流量均为e.f(>0), 费用均为0. 再连边T$\to$S流量$\infty$费用0. 此时没有负环了. 做一遍SS到TT的最小费用最大流, 将费用累加ans, 拆掉T$\to$S的那条边 (此边的流量为残量网络中S$\to$T的流量). 此时负环已消, 再继续跑最小费用最大流.
\begin{comment}
\subsubsection*{二分图最小点覆盖和最大独立集}
\noindent
最小点覆盖: 求出一个最大匹配, 从左部开始每次寻找一个未匹配点, 从该点出发可以得到``未匹配-匹配-未匹配..."形式的交错树, 标记所有这些点. 则最小点覆盖方案为右部未标记点与左部标记点的并集. 显然最小点覆盖集合大小 = 最大匹配.\\
最大独立集 = 全集 - 最小点覆盖.
\end{comment}
\subsubsection*{整数线性规划转费用流}
\noindent
首先将约束关系转化为所有变量下界为$0$, 上界没有要求, 并满足一些等式,
每个变量在均在等式左边且出现恰好两次, 系数为$+1$和$-1$, 优化目标为$\max\sum v_ix_i$的形式.
将等式看做点, 等式i右边的值$b_i$若为正, 则$S$向$i$连边$(b_i, 0)$, 否则i向T连边$(-b_i, 0)$.
将变量看做边, 记变量$x_i$的上界为$m_i$(无上界则$m_i=inf$), 将$x_i$系数为$+1$的那个等式$u$向系数为$-1$的等式$v$连边$(m_i, v_i)$.